(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[284],{2317:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return w}});var r=t(29),a=t(7794),i=t.n(a),o=t(7294),c=t(9046),s=t(2626),u=t(5893),d=(0,o.createContext)(null);function l(e){var n=e.children,t=(0,o.useState)(null),r=t[0],a=t[1];return(0,o.useEffect)((function(){c.WalletUtils.ready((function(e){var n,t,r,i=e.body,o=i.timestamp,c=i.appDomainTag,u=e.service,d=null===u||void 0===u||null===(n=u.data)||void 0===n?void 0:n.address,l=null===u||void 0===u||null===(t=u.data)||void 0===t?void 0:t.keyId,f=new Set((0,s.v)(null===u||void 0===u||null===(r=u.params)||void 0===r?void 0:r.scopes));a({address:d,keyId:l,scopes:f,timestamp:o,appDomainTag:c})}))}),[]),(0,u.jsx)(d.Provider,{value:r,children:n})}var f=function(){return(0,o.useContext)(d)},p=t(7255),v=t(4024),m=t(6873),y=t(9977);function h(e){var n=e.flowAccountPrivateKey,t=f();if(t){var r=t.address,a=t.keyId,i=t.scopes,o=t.nonce,c=t.appIdentifier;(0,p.O)(n,r,a,i,o,c)}return(0,y.tZ)(v.Z,{root:!0,children:"Refreshing..."})}function _(e){var n=e.flowAccountPrivateKey;return(0,y.tZ)(l,{children:(0,y.tZ)(h,{flowAccountPrivateKey:n})})}_.getInitialProps=(0,r.Z)(i().mark((function e(){var n,t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,m.BR)();case 2:return n=e.sent,t=n.flowAccountPrivateKey,e.abrupt("return",{flowAccountPrivateKey:t});case 5:case"end":return e.stop()}}),e)})));var w=_},7255:function(e,n,t){"use strict";t.d(n,{E:function(){return I},O:function(){return O}});var r=t(29),a=t(7794),i=t.n(a),o=t(9046),c=t(6917),s=t(1752),u=t(9499),d=t(7812);function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function f(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){(0,u.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var p=new Set("name family_name given_name middle_name nickname preferred_username profile picture website gender birthday zoneinfo locale updated_at".trim().split(/\s+/)),v=new Set("email email_verified".trim().split(/\s+/)),m=function(e,n){return new Set((0,d.Z)(e).filter((function(e){return n.has(e)})))};function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=[e].flatMap((function(e){return e})).filter(Boolean);return Object.fromEntries(n)}var h=function(e,n,t){return e.has(n)&&[n,t]},_=function(e){var n,t=e.baseUrl,r=e.address,a=e.nonce,i=e.scopes,o=e.compSig,c=e.keyId,s=e.includeRefresh,u=void 0!==s&&s,d=[{f_type:"Service",f_vsn:"1.0.0",type:"authn",uid:"fcl-dev-wallet#authn",endpoint:"".concat(t,"/fcl/authn"),id:r,identity:{address:r},provider:{address:null,name:"FCL Dev Wallet",icon:null,description:"For Local Development Only"}},{f_type:"Service",f_vsn:"1.0.0",type:"authz",uid:"fcl-dev-wallet#authz",endpoint:"".concat(t,"/fcl/authz"),method:"IFRAME/RPC",identity:{address:r,keyId:Number(c)}},{f_type:"Service",f_vsn:"1.0.0",type:"user-signature",uid:"fcl-dev-wallet#user-sig",endpoint:"".concat(t,"/fcl/user-sig"),method:"IFRAME/RPC",id:r,data:{addr:r,keyId:Number(c)},params:{}}];a&&d.push({f_type:"Service",f_vsn:"1.0.0",type:"account-proof",method:"DATA",uid:"fcl-dev-wallet#account-proof",data:{f_type:"account-proof",f_vsn:"1.0.0",address:r,nonce:a,signatures:null!==(n=[o])&&void 0!==n?n:null}});return u&&d.push({f_type:"Service",f_vsn:"1.0.0",type:"authn-refresh",uid:"fcl-dev-wallet#authn-refresh",endpoint:"".concat(t,"/fcl/authn-refresh"),method:"IFRAME/RPC",id:r,data:{f_type:"authn-refresh",f_vsn:"1.0.0",address:r,keyId:Number(c)},params:{sessionId:"C7OXWaVpU-efRymW7a5d",scopes:Array.from(i).join(" ")}}),i.size&&d.push({f_type:"Service",f_vsn:"1.0.0",type:"open-id",uid:"fcl-dev-wallet#open-id",method:"data",data:f({f_type:"OpenID",f_vsn:"1.0.0"},y([m(p,i).size&&["profile",y([h(i,"name","name[".concat(r,"]")),h(i,"family_name","family_name[".concat(r,"]")),h(i,"given_name","given_name[".concat(r,"]")),h(i,"middle_name","middle_name[".concat(r,"]")),h(i,"nickname","nickname[".concat(r,"]")),h(i,"preferred_username","preferred_username[".concat(r,"]")),h(i,"profile","https://onflow.org"),h(i,"piture","https://https://avatars.onflow.org/avatar/".concat(r)),h(i,"website","https://onflow.org"),h(i,"gender","gender[".concat(r,"]")),h(i,"birthday","0000-".concat((new Date).getMonth()+1,"-").concat((new Date).getDate())),h(i,"zoneinfo","America/Vancouver"),h(i,"locale","en"),h(i,"updated_at",Date.now())])],m(v,i).size&&["email",y([h(i,"email","".concat(r,"@example.com")),h(i,"email_verified",!0)])]]))}),d},w=(0,s.default)().publicRuntimeConfig,g=function(e,n){return(0,c.X)(e,o.WalletUtils.encodeAccountProof(n))};function b(e,n,t,r,a){return{addr:n,keyId:t,signature:g(e,{address:n,nonce:r,appIdentifier:a})}}function O(e,n,t,r,a,i){var c=g(e,{address:n,nonce:a,appIdentifier:i}),s=new o.WalletUtils.CompositeSignature(n,t,c),u=_({baseUrl:w.baseUrl,address:n,nonce:a,scopes:r,compSig:s,keyId:t,includeRefresh:!1});o.WalletUtils.approve({f_type:"AuthnResponse",f_vsn:"1.0.0",addr:n,services:u})}function I(e,n,t,r){return P.apply(this,arguments)}function P(){return(P=(0,r.Z)(i().mark((function e(n,t,r,a){var c,s,u,d,l,f,p,v,m,y;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=t.address,s=t.keyId,u=a.body,d=u.nonce,l=u.appIdentifier,d&&(p=b(n,c,s,d,l),v=p.addr,m=p.signature,f=new o.WalletUtils.CompositeSignature(v,s,m)),y=_({baseUrl:w.baseUrl,address:c,nonce:d,scopes:r,compSig:f,keyId:s,includeRefresh:!1}),localStorage.setItem("connectedAppConfig",JSON.stringify(a)),o.WalletUtils.sendMsgToFCL("FCL:VIEW:RESPONSE",{addr:c,services:y});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2626:function(e,n,t){"use strict";t.d(n,{v:function(){return r}});var r=function(e){var n,t;return null!==(n=null===e||void 0===e||null===(t=e.trim())||void 0===t?void 0:t.split(/\s+/))&&void 0!==n?n:[]}},2867:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fcl/authn-refresh",function(){return t(2317)}])}},function(e){e.O(0,[184,325,313,774,888,179],(function(){return n=2867,e(e.s=n);var n}));var n=e.O();_N_E=n}]);
//# sourceMappingURL=authn-refresh-8e4ca393a52d68a8.js.map