{"version":3,"file":"static/chunks/pages/fcl/user-sig-f061b573d7e451f8.js","mappings":"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","sources":["webpack://_N_E/./components/AuthzActions.tsx","webpack://_N_E/./components/AuthzDetailsTable.tsx","webpack://_N_E/./hooks/useConfig.ts","webpack://_N_E/./pages/fcl/user-sig.tsx","webpack://_N_E/?209a"],"sourcesContent":["/** @jsxImportSource theme-ui */\nimport {SXStyles} from \"types\"\nimport Button from \"./Button\"\n\nconst styles: SXStyles = {\n  actionsContainer: {\n    display: \"flex\",\n    alignItems: \"center\",\n    width: \"100%\",\n    borderTop: \"1px solid\",\n    borderColor: \"gray.200\",\n    backgroundColor: \"white\",\n    borderBottomLeftRadius: 10,\n    borderBottomRightRadius: 10,\n    px: [10, 20],\n  },\n  actions: {\n    display: \"flex\",\n    flex: 1,\n    pt: 20,\n    pb: 20,\n  },\n}\n\nfunction AuthzActions({\n  onApprove,\n  onDecline,\n  isLoading,\n}: {\n  onApprove: () => void\n  onDecline: () => void\n  isLoading?: boolean\n}) {\n  return (\n    <div sx={styles.actionsContainer}>\n      <div sx={styles.actions}>\n        <Button\n          variant=\"ghost\"\n          size=\"lg\"\n          sx={{flex: 1, mx: 10, w: \"50%\"}}\n          onClick={onDecline}\n        >\n          Decline\n        </Button>\n        <Button\n          size=\"lg\"\n          sx={{flex: 1, mx: 10, w: \"50%\"}}\n          onClick={onApprove}\n          disabled={isLoading}\n          data-test=\"approve-transaction-button\"\n        >\n          Approve\n        </Button>\n      </div>\n    </div>\n  )\n}\n\nexport default AuthzActions\n","/** @jsxImportSource theme-ui */\nimport {alpha} from \"@theme-ui/color\"\nimport useAuthzContext from \"hooks/useAuthzContext\"\nimport {Account} from \"src/accounts\"\nimport {SXStyles} from \"types\"\n\nconst styles: SXStyles = {\n  table: {\n    fontSize: [0, 1],\n    width: \"100%\",\n    borderCollapse: \"collapse\",\n    \"word-break\": \"break-word\",\n  },\n  row: {\n    \"> td\": {\n      borderBottom: \"1px solid\",\n      borderColor: alpha(\"gray.200\", 0.7),\n      verticalAlign: \"top\",\n      py: 1,\n      \"&:first-of-type\": {\n        color: \"gray.500\",\n      },\n      \"&:last-of-type\": {\n        textAlign: \"right\",\n        fontFamily: \"monospace\",\n        letterSpacing: \"0.16em\",\n      },\n    },\n    \"&:last-of-type\": {\n      \"> td\": {\n        border: 0,\n      },\n    },\n  },\n  accountDetail: {\n    display: \"flex\",\n    alignItems: [\"flex-end\", \"center\"],\n    justifyContent: \"flex-end\",\n    flexDirection: [\"column\", \"row\"],\n  },\n  accountDetailLabel: {\n    textTransform: \"uppercase\",\n    fontFamily: \"sans-serif\",\n    fontSize: \"0.625rem\",\n    letterSpacing: \"initial\",\n    color: \"gray.300\",\n    border: \"1px solid\",\n    borderColor: \"gray.200\",\n    borderRadius: 20,\n    px: 2,\n  },\n  accountAddress: {\n    ml: 2,\n  },\n  accountDetailLabelCurrent: {\n    backgroundColor: \"primary\",\n    borderColor: \"primary\",\n    color: \"black\",\n    fontWeight: 700,\n  },\n}\n\nexport function AuthzDetailsAccount({account}: {account: Account}) {\n  const {currentUser} = useAuthzContext()\n  const isCurrent = account.address === currentUser.address\n  return (\n    <div sx={styles.accountDetail}>\n      <div\n        sx={{\n          ...styles.accountDetailLabel,\n          ...(isCurrent ? styles.accountDetailLabelCurrent : {}),\n        }}\n      >\n        {account.label}\n      </div>\n      <div sx={styles.accountAddress}>{account.address}</div>\n    </div>\n  )\n}\n\nexport function AuthzDetailsRow({children}: {children: React.ReactNode}) {\n  return <tr sx={styles.row}>{children}</tr>\n}\n\nfunction AuthzDetailsTable({children}: {children: React.ReactNode}) {\n  return (\n    <table sx={styles.table}>\n      <thead>\n        <tr>\n          <th sx={{minWidth: 100}} />\n          <th />\n        </tr>\n      </thead>\n      <tbody>{children}</tbody>\n    </table>\n  )\n}\n\nexport default AuthzDetailsTable\n","import {ConfigContext} from \"contexts/ConfigContext\"\nimport {useContext} from \"react\"\n\nconst useConfig = () => {\n  return useContext(ConfigContext)\n}\n\nexport default useConfig\n","/** @jsxImportSource theme-ui */\nimport {WalletUtils} from \"@onflow/fcl\"\nimport AuthzActions from \"components/AuthzActions\"\nimport AuthzDetailsTable, {AuthzDetailsRow} from \"components/AuthzDetailsTable\"\nimport Dialog from \"components/Dialog\"\nimport {useEffect, useState} from \"react\"\nimport {sign} from \"src/crypto\"\nimport {Box, Themed} from \"theme-ui\"\nimport getWalletConfig from \"hooks/useConfig\"\n\ntype AuthReadyResponseSignable = {\n  data: {\n    addr: string\n    keyId: string\n  }\n  message: string\n}\n\ntype AuthReadyResponseData = {\n  type: string\n  body: AuthReadyResponseSignable\n}\n\nfunction userSignature(\n  signable: AuthReadyResponseSignable,\n  privateKey: string\n) {\n  const {\n    message,\n    data: {addr, keyId},\n  } = signable\n\n  const rightPaddedHexBuffer = (value: string, pad: number) =>\n    Buffer.from(value.padEnd(pad * 2, \"0\"), \"hex\")\n\n  const USER_DOMAIN_TAG = rightPaddedHexBuffer(\n    Buffer.from(\"FLOW-V0.0-user\").toString(\"hex\"),\n    32\n  ).toString(\"hex\")\n\n  const prependUserDomainTag = (msg: string) => USER_DOMAIN_TAG + msg\n\n  return {\n    addr: addr,\n    keyId: keyId,\n    signature: sign(privateKey, prependUserDomainTag(message)),\n  }\n}\n\nexport default function UserSign() {\n  const {flowAccountPrivateKey} = getWalletConfig()\n\n  const [signable, setSignable] = useState<AuthReadyResponseSignable | null>(\n    null\n  )\n\n  useEffect(() => {\n    function callback(data: AuthReadyResponseData) {\n      setSignable(data.body)\n    }\n\n    WalletUtils.ready(callback)\n  }, [])\n\n  function onApprove() {\n    const {addr, keyId, signature} = userSignature(\n      signable!,\n      flowAccountPrivateKey\n    )\n\n    WalletUtils.approve(\n      new WalletUtils.CompositeSignature(addr, keyId, signature)\n    )\n  }\n\n  const onDecline = () => {\n    WalletUtils.decline(\"User declined\")\n  }\n\n  return (\n    <Dialog\n      footer={\n        <AuthzActions\n          onApprove={onApprove}\n          onDecline={onDecline}\n          isLoading={false}\n        />\n      }\n    >\n      <Themed.h1 sx={{textAlign: \"center\", mb: 0}}>Sign Message</Themed.h1>\n      <Themed.p sx={{textAlign: \"center\", mb: 4}}>\n        Please prove that you have access to this wallet.\n        <br />\n        This wonâ€™t cost you any FLOW.\n      </Themed.p>\n      <Box mb={20}>\n        <AuthzDetailsTable>\n          <AuthzDetailsRow>\n            <td>Address</td>\n            <td>{signable?.data.addr}</td>\n          </AuthzDetailsRow>\n          <AuthzDetailsRow>\n            <td>Key ID</td>\n            <td>{signable?.data.keyId}</td>\n          </AuthzDetailsRow>\n          <AuthzDetailsRow>\n            <td>Message (Hex)</td>\n            <td>{signable?.message}</td>\n          </AuthzDetailsRow>\n        </AuthzDetailsTable>\n      </Box>\n    </Dialog>\n  )\n}\n","\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/fcl/user-sig\",\n      function () {\n        return require(\"private-next-pages/fcl/user-sig.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/fcl/user-sig\"])\n      });\n    }\n  "],"names":["styles","actionsContainer","display","alignItems","width","borderTop","borderColor","backgroundColor","borderBottomLeftRadius","borderBottomRightRadius","px","actions","flex","pt","pb","onApprove","onDecline","isLoading","sx","variant","size","mx","w","onClick","disabled","table","fontSize","borderCollapse","row","borderBottom","alpha","verticalAlign","py","color","textAlign","fontFamily","letterSpacing","border","accountDetail","justifyContent","flexDirection","accountDetailLabel","textTransform","borderRadius","accountAddress","ml","accountDetailLabelCurrent","fontWeight","AuthzDetailsAccount","account","currentUser","useAuthzContext","isCurrent","address","label","AuthzDetailsRow","children","minWidth","useContext","ConfigContext","UserSign","flowAccountPrivateKey","getWalletConfig","useState","signable","setSignable","useEffect","WalletUtils","data","body","footer","privateKey","value","pad","msg","message","addr","keyId","USER_DOMAIN_TAG","Buffer","from","toString","padEnd","signature","sign","userSignature","mb","window","__NEXT_P","push"],"sourceRoot":""}